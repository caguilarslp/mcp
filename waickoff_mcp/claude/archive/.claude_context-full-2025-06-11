# ü§ñ Contexto para Claude/Cursor - wAIckoff MCP Server v1.6.4 (PRODUCTION READY + MODULAR ARCHITECTURE)

## üéÜ ESTADO CR√çTICO v1.6.5 - TASK-019 COMPILACI√ìN RESUELTOS 100%
**‚úÖ COMPILACI√ìN EXITOSA**: `npm run build` sin errores - TASK-019 finalizada completamente
**‚úÖ ERRORES RESUELTOS**: Conflictos de nombres y tipos completamente corregidos
**‚úÖ HANDLERS AGREGADOS**: 4 placeholders para nuevas herramientas t√©cnicas implementados
**‚úÖ IMPORTS CORREGIDOS**: Todos los servicios usando clases correctas
**‚úÖ TYPE SAFETY MANTENIDA**: Sistema compilando con casting temporal apropiado
**‚úÖ BACKWARD COMPATIBLE**: Todas las funcionalidades existentes preservadas
**üéØ SISTEMA ESTABLE**: Base s√≥lida para desarrollo de an√°lisis t√©cnico avanzado
**üöÄ PRODUCTION READY**: Sistema listo con arquitectura modular escalable y compilaci√≥n limpia

## IMPORTANTE: Leer ANTES de dar cualquier sugerencia

### üìä SISTEMA DE TRAZABILIDAD COMPLETA v1.3.4 (OBLIGATORIO)
**‚ö†Ô∏è CAMBIO CR√çTICO**: Sistema de logging avanzado implementado - revisar documentaci√≥n de debugging
**SIEMPRE** revisar y actualizar estos archivos en orden de prioridad:

#### **üìã Archivos Cr√≠ticos de Estado:**
- `claude/master-log.md` - **Estado actual del MCP (LEER PRIMERO)**
- `claude/tasks/task-tracker.md` - Pr√≥ximas funciones a implementar
- `claude/bugs/` - **NUEVA** carpeta con bugs documentados y soluciones
- `claude/lessons-learned/` - **NUEVA** carpeta con lecciones aprendidas cr√≠ticas
- `claude/docs/` - **NUEVA** documentaci√≥n t√©cnica completa de features
- `claude/logs/YYYY-MM-DD.md` - Log diario (ACTUALIZAR al final)

#### **üìö Documentaci√≥n T√©cnica:**
- `claude/docs/architecture/system-overview.md` - **NUEVA** arquitectura completa
- `claude/docs/api/tools-reference.md` - **NUEVA** referencia de API
- `claude/docs/troubleshooting/common-issues.md` - **NUEVA** gu√≠a de resoluci√≥n
- `claude/docs/user-guide.md` - **UBICACI√ìN OFICIAL** Gu√≠a completa de usuario v1.6.4
- `claude/docs/task-005-wyckoff-basic-complete.md` - **NUEVA** documentaci√≥n Wyckoff B√°sico
- `claude/docs/task-005-auto-save-system.md` - **NUEVA** documentaci√≥n auto-save
- `claude/docs/task-009-storage-system-complete.md` - **NUEVA** documentaci√≥n storage completo
- `claude/docs/timezone-system.md` - **NUEVA** documentaci√≥n sistema timezone
- `claude/docs/timezone-future-recommendations.md` - **NUEVA** recomendaciones timezone
- `claude/decisions/adr-log.md` - Decisiones arquitect√≥nicas
- `claude/lessons-learned/README.md` - **NUEVA** √≠ndice de lecciones aprendidas
- `claude/bugs/bug-004-storage-query-pattern.md` - **NUEVA** soluci√≥n pattern matching
- `ROADMAP_AVANZADO.md` - Visi√≥n general de funcionalidades futuras

#### **üêõ Gesti√≥n de Bugs:**
- **SISTEMA COMPLETO**: Todos los bugs cr√≠ticos se documentan en `claude/bugs/`
- **Formato**: `bug-XXX-description.md` con an√°lisis completo
- **Registro**: `claude/bugs/README.md` con √≠ndice y m√©tricas
- **Ejemplos**: BUG-001 (S/R classification), BUG-002 (Architecture refactor), BUG-004 (Storage pattern)

#### **üìö Gesti√≥n de Lecciones Aprendidas:**
- **SISTEMA NUEVO**: Todas las lecciones cr√≠ticas en `claude/lessons-learned/`
- **Formato**: `lesson-XXX-description.md` con an√°lisis y patterns
- **Registro**: `claude/lessons-learned/README.md` con √≠ndice y templates
- **Ejemplos**: LESSON-001 (Auto-save implementation failure)

### üéÜ ESTADO ACTUAL (v1.6.4 - 11/06/2025) - TASK-018 COMPLETADA
- **Fase:** ‚úÖ TASK-018 COMPLETADA - Arquitectura modular MCP 100% funcional y compilando
- **√öltima Actualizaci√≥n:** v1.6.4 con sistema modular completo y tipos TypeScript validados
- **Pr√≥xima Decisi√≥n:** Sistema base completamente s√≥lido - listo para nuevas funcionalidades avanzadas
- **Bloqueadores:** NINGUNO - Sistema 100% estable y escalable
- **UX Status:** üéÜ EXCELENTE - An√°lisis + Storage + Cache + Repository + Reports + Configuration + Historical + System + Traps + Wyckoff + Modular
- **Funcionalidad:** ‚úÖ Sistema MCP completamente modular y production-ready con arquitectura escalable

### üèóÔ∏è NUEVA ARQUITECTURA STORAGE SERVICE v1.3.8
**‚úÖ REFACTORIZACI√ìN MODULAR COMPLETA**: StorageService dividido en servicios especializados
**üîß BUG-004 RESUELTO**: Pattern matching cross-platform robusto
**üìÅ SEPARACI√ìN DE CONCERNS**: Cada servicio con responsabilidad √∫nica

#### **üìÇ Storage Service Architecture**
- ‚úÖ **FileSystemService** (`src/services/storage/fileSystemService.ts`)
  - Operaciones de bajo nivel: read, write, delete, walk
  - Manejo at√≥mico con archivos temporales
  - Error handling especializado
  
- ‚úÖ **PatternMatcher** (`src/services/storage/patternMatcher.ts`)
  - Conversi√≥n glob ‚Üí regex mejorada
  - Soporte `*` (single dir) y `**` (recursive)
  - Normalizaci√≥n consistente de paths
  
- ‚úÖ **StorageConfigService** (`src/services/storage/storageConfig.ts`)
  - Gesti√≥n centralizada de configuraci√≥n
  - Validaci√≥n de l√≠mites y constraints
  - Estructura de directorios predefinida
  
- ‚úÖ **StorageService** (`src/services/storage.ts`)
  - Orquestador de alto nivel
  - Delega a servicios especializados
  - API p√∫blica simplificada

### üéÜ ARQUITECTURA MODULAR v1.3.8 - COMPLETAMENTE OPERATIVA
**‚úÖ SISTEMA DE HANDLERS**: MCPHandlers + delegation pattern funcionando
**üèóÔ∏è STORAGE MODULARIZADO**: Nueva arquitectura para servicios de storage
**üß™ 100% TESTEABLE**: Cada servicio independiente y mockeable
**üîÑ BACKWARD COMPATIBLE**: APIs MCP sin cambios
**‚úÖ CLEAN COMPILATION**: 0 errores TypeScript

#### **üéØ CAPAS Y SERVICIOS IMPLEMENTADOS**

#### **üè¢ Presentation Layer (Adapters) - MODULAR SYSTEM**
- ‚úÖ **MCP Adapter** (`src/adapters/mcp.ts`) - Protocolo MCP con routing a handlers
- ‚úÖ **MCPHandlers** (`src/adapters/mcp-handlers.ts`) - Orquestador central con delegation
- ‚úÖ **MarketDataHandlers** (`src/adapters/handlers/marketDataHandlers.ts`) - Handlers especializados
- ‚úÖ **AnalysisRepositoryHandlers** (`src/adapters/handlers/analysisRepositoryHandlers.ts`) - TASK-009 FASE 3
- ‚úÖ **CacheHandlers** (`src/adapters/cacheHandlers.ts`) - Operaciones de cache
- üîÆ **REST API Adapter** (Futuro) - FastAPI integration ready
- üîÆ **WebSocket Adapter** (Futuro) - Real-time streams
- üîÆ **CLI Adapter** (Futuro) - Command line interface

#### **üß† Core Layer (Business Logic)**
- ‚úÖ **Market Analysis Engine** (`src/core/engine.ts`) - Orquestador principal
- ‚úÖ **System Configuration** - Configuraci√≥n centralizada
- ‚úÖ **Health Monitoring** - Estado del sistema
- ‚úÖ **Performance Tracking** - M√©tricas autom√°ticas
- ‚úÖ **Analysis Repository Integration** - FASE 3 completa

#### **‚öôÔ∏è Service Layer (Specialized Services)**
- ‚úÖ **Market Data Service** (`src/services/marketData.ts`) - Bybit API integration
- ‚úÖ **Technical Analysis Service** (`src/services/analysis.ts`) - An√°lisis t√©cnico
- ‚úÖ **Trading Service** (`src/services/trading.ts`) - Grid trading & strategies
- ‚úÖ **Storage Service** (`src/services/storage/`) - Sistema modularizado nuevo
- ‚úÖ **Cache Manager** (`src/services/cacheManager.ts`) - Cache con TTL
- ‚úÖ **Analysis Repository** (`src/repositories/analysisRepository.ts`) - Gesti√≥n de an√°lisis
- üîÆ **Multi-Exchange Services** (Futuro) - Binance, Coinbase, etc.

#### **üõ†Ô∏è Utility Layer (Common Tools)**
- ‚úÖ **Logger** (`src/utils/logger.ts`) - Sistema de logs estructurado
- ‚úÖ **Performance Monitor** (`src/utils/performance.ts`) - M√©tricas de rendimiento
- ‚úÖ **Math Utils** (`src/utils/math.ts`) - Utilidades matem√°ticas
- ‚úÖ **Type Definitions** (`src/types/index.ts`) - Tipos centralizados

#### **üî• PATR√ìN DE MODULARIDAD v1.3.7 - DELEGATION ARCHITECTURE**

##### **‚úÖ Sistema de Handlers Especializado**
```typescript
// MCPHandlers act√∫a como coordinador central
export class MCPHandlers {
  private marketDataHandlers: MarketDataHandlers;
  private analysisRepositoryHandlers: AnalysisRepositoryHandlers;
  private cacheHandlers: CacheHandlers;
  
  // Delegation to specialized handlers
  async handleGetTicker(args: any) {
    return await this.marketDataHandlers.handleGetTicker(args);
  }
}
```

##### **‚úÖ MCP Adapter Simplificado**
- **Eliminado c√≥digo duplicado**: 2000+ l√≠neas reducidas a ~500 l√≠neas limpias
- **Routing limpio**: Switch simple que delega a handlers especializados
- **Mantenimiento sencillo**: Cambios localizados en handlers espec√≠ficos

##### **‚úÖ Handlers Especializados por Dominio**
- **MarketDataHandlers**: `handleGetTicker`, `handleGetOrderbook`, `handleGetMarketData`
- **AnalysisRepositoryHandlers**: TASK-009 FASE 3 handlers completos (7 herramientas)
- **CacheHandlers**: `handleGetCacheStats`, `handleClearCache`, `handleInvalidateCache`

### üéØ Funcionalidades IMPLEMENTADAS v1.4.0 (SISTEMA COMPLETO + TESTS)

#### **üèóÔ∏è ARQUITECTURA & INFRAESTRUCTURA**
- ‚úÖ **üéÜ ARQUITECTURA MODULAR REPARADA** - Sistema de handlers completamente funcional
- ‚úÖ **Delegation pattern** - MCPHandlers coordina handlers especializados
- ‚úÖ **Handlers por dominio** - MarketData, AnalysisRepository, Cache, ReportGenerator separados
- ‚úÖ **Compilaci√≥n limpia** - 0 errores TypeScript
- ‚úÖ **Separation of concerns** - Cada handler con responsabilidad espec√≠fica
- ‚úÖ **TASK-009 FASE 4 COMPLETA** - Report Generator con 8 herramientas operativas
- ‚úÖ **TASK-004 TESTS CONFIGURADOS** - Sistema completo de tests unitarios
- ‚úÖ **Storage Service Modularizado** - FileSystem + PatternMatcher + Config
- ‚úÖ **100% Testeable** - Cada servicio mockeable independientemente
- ‚úÖ **Performance optimizado** - Eliminado c√≥digo duplicado masivo
- ‚úÖ **Engine API Expandido** - M√©todos granulares getTicker, getOrderbook, getKlines

#### **üì¶ TASK-009 STORAGE SYSTEM (100% COMPLETO)**
- ‚úÖ **FASE 1: StorageService Base** - Operaciones CRUD funcionando
- ‚úÖ **FASE 2: Cache Manager** - In-memory cache con TTL y LRU
- ‚úÖ **FASE 3: Analysis Repository** - 7 herramientas MCP operativas:
  - `get_analysis_by_id` - Buscar por UUID
  - `get_latest_analysis` - √öltimo an√°lisis por tipo
  - `search_analyses` - B√∫squeda compleja
  - `get_analysis_summary` - Resumen agregado
  - `get_aggregated_metrics` - M√©tricas estad√≠sticas
  - `find_patterns` - Buscar patrones
  - `get_repository_stats` - Estad√≠sticas del repo
- ‚úÖ **FASE 4: Report Generator** - 8 herramientas MCP operativas:
  - `generate_report` - Generar reporte personalizado
  - `generate_daily_report` - Reporte diario autom√°tico
  - `generate_weekly_report` - Reporte semanal
  - `generate_symbol_report` - Reporte por s√≠mbolo
  - `generate_performance_report` - An√°lisis de rendimiento
  - `get_report` - Obtener reporte por ID
  - `list_reports` - Listar reportes disponibles
  - `export_report` - Exportar reporte a archivo

#### **üéØ TASK-005 WYCKOFF B√ÅSICO (100% COMPLETO)**
- ‚úÖ **WyckoffBasicService** - An√°lisis completo de metodolog√≠a Wyckoff b√°sica
- ‚úÖ **15 fases Wyckoff identificadas** - Acumulaci√≥n A-E, Distribuci√≥n A-E, Markup, Markdown
- ‚úÖ **Algoritmos de detecci√≥n avanzados** - Springs, upthrusts, test events con scoring 0-100
- ‚úÖ **Trading range detection** - Consolidaci√≥n con validaci√≥n temporal y volumen
- ‚úÖ **Volume context analysis** - Climax events, dry-up periods, trend analysis
- ‚úÖ **7 herramientas MCP Wyckoff**:
  - `analyze_wyckoff_phase` - An√°lisis completo de fase actual
  - `detect_trading_range` - Detecci√≥n de rangos de consolidaci√≥n
  - `find_wyckoff_events` - B√∫squeda de springs, upthrusts, tests
  - `analyze_wyckoff_volume` - An√°lisis de volumen en contexto Wyckoff
  - `get_wyckoff_interpretation` - Interpretaci√≥n comprensiva con bias
  - `track_phase_progression` - Seguimiento de progreso y timeline
  - `validate_wyckoff_setup` - Validaci√≥n de setup con risk assessment

#### **üéØ TASK-012 DETECCI√ìN TRAMPAS (100% COMPLETO)**
- ‚úÖ **TrapDetectionService** - Algoritmos avanzados para detecci√≥n de trampas
- ‚úÖ **An√°lisis multi-se√±al** - Combina volumen, orderbook, Volume Delta y momentum
- ‚úÖ **Sistema de triggers con pesos** - Cada se√±al tiene peso y umbral espec√≠fico
- ‚úÖ **7 herramientas MCP Trampas**:
  - `detect_bull_trap` - Detecta falsas rupturas alcistas sobre resistencia
  - `detect_bear_trap` - Detecta falsas rupturas bajistas bajo soporte
  - `get_trap_history` - Historial de trampas detectadas para backtesting
  - `get_trap_statistics` - Estad√≠sticas de rendimiento de detecci√≥n
  - `configure_trap_detection` - Configuraci√≥n de par√°metros de detecci√≥n
  - `validate_breakout` - Validaci√≥n de situaciones de ruptura actuales
  - `get_trap_performance` - M√©tricas de rendimiento del servicio

#### **üìú TASK-017 AN√ÅLISIS HIST√ìRICO (100% COMPLETO)**
- ‚úÖ **HistoricalDataService** - Acceso a datos hist√≥ricos desde inception
- ‚úÖ **HistoricalAnalysisService** - An√°lisis S/R hist√≥rico, eventos volumen
- ‚úÖ **HistoricalCacheService** - Cache optimizado para datos hist√≥ricos
- ‚úÖ **6 herramientas MCP Hist√≥ricas**:
  - `get_historical_klines` - Datos hist√≥ricos OHLCV con metadata
  - `analyze_historical_sr` - An√°lisis avanzado S/R hist√≥rico con scoring
  - `identify_volume_anomalies` - Detecci√≥n de eventos de volumen significativos
  - `get_price_distribution` - An√°lisis distribuci√≥n precios y value areas
  - `identify_market_cycles` - Identificaci√≥n de ciclos de mercado hist√≥ricos
  - `get_historical_summary` - Resumen comprehensivo an√°lisis hist√≥rico

#### **‚öôÔ∏è TASK-010 CONFIGURACI√ìN SISTEMA (100% COMPLETO)**
- ‚úÖ **ConfigurationManager** - Gesti√≥n completa de configuraci√≥n persistente
- ‚úÖ **Auto-detecci√≥n timezone** - M√∫ltiples m√©todos de detecci√≥n con fallback
- ‚úÖ **7 herramientas MCP Configuraci√≥n**:
  - `get_user_config` - Configuraci√≥n completa del usuario
  - `set_user_timezone` - Configurar zona horaria con auto-detect
  - `detect_timezone` - Auto-detectar zona horaria del sistema
  - `update_config` - Actualizar m√∫ltiples secciones
  - `reset_config` - Reset a defaults con auto-detecci√≥n
  - `validate_config` - Validar configuraci√≥n y sugerencias
  - `get_config_info` - Info archivo y timezones soportadas

#### **üåç TASK-015b SOPORTE .ENV (100% COMPLETO)**
- ‚úÖ **EnvironmentConfig service** - Parser manual de .env sin dependencias
- ‚úÖ **Auto-discovery** - B√∫squeda autom√°tica desde directorio hasta project root
- ‚úÖ **Cross-platform support** - Windows, Linux, macOS, Docker, CI/CD
- ‚úÖ **9 herramientas MCP Sistema**:
  - `get_system_config` - Configuraci√≥n completa desde variables entorno
  - `get_mongo_config` - Estado configuraci√≥n MongoDB
  - `get_api_config` - Configuraci√≥n APIs externas
  - `get_analysis_config` - Par√°metros an√°lisis t√©cnico
  - `get_grid_config` - Configuraci√≥n grid trading
  - `get_logging_config` - Configuraci√≥n logging y monitoreo
  - `validate_env_config` - Validaci√≥n con errores y warnings
  - `reload_env_config` - Recarga configuraci√≥n en caliente
  - `get_env_file_info` - Info archivo .env con template

#### **üèóÔ∏è TASK-018 MODULARIZACI√ìN MCP (100% COMPLETO)**
- ‚úÖ **Reducci√≥n masiva** - mcp.ts de 55KB ‚Üí 3.6KB (93.3% reducci√≥n)
- ‚úÖ **15 archivos especializados** - Herramientas organizadas por categor√≠a
- ‚úÖ **Registry din√°mico** - Sistema O(1) lookup con validaci√≥n autom√°tica
- ‚úÖ **Router modular** - Performance tracking y error handling
- ‚úÖ **Zero breaking changes** - 100% backward compatible
- ‚úÖ **Problema corrupci√≥n eliminado** - Para siempre

#### **üîç SISTEMA DE LOGGING Y DEBUGGING OPTIMIZADO**
- ‚úÖ **API Statistics b√°sicos** - Total requests, errors, success rate en memoria
- ‚úÖ **Error tracking simple** - √öltimos 5 errores con timestamp
- ‚úÖ **Connection monitoring** - Status HTTP, timeouts, parsing errors
- ‚úÖ **Zero complex objects** - Eliminados objetos que causaban errores JSON
- ‚úÖ **Claude Desktop compatible** - Sin errores molestos en UI
- ‚úÖ **Performance b√°sico** - Duraci√≥n de requests sin overhead
- ‚úÖ **Essential debugging** - Solo lo necesario para troubleshooting
- ‚úÖ **Production ready** - Sistema estable sin logs verbosos

#### **üìä FUNCIONALIDADES DE AN√ÅLISIS**
- ‚úÖ **Market Data Service** - Ticker, orderbook, klines con error handling
- ‚úÖ **Technical Analysis Service** - Volatilidad, volumen, Volume Delta, S/R
- ‚úÖ **Trading Service** - Grid trading inteligente basado en volatilidad
- ‚úÖ **Support/Resistance avanzado** - Algoritmo multi-factor con scoring
- ‚úÖ **Volume Delta aproximado** - Presi√≥n compradora/vendedora sin API key
- ‚úÖ **Divergence detection** - Detecci√≥n temprana de reversiones
- ‚úÖ **VWAP integration** - An√°lisis de valor promedio ponderado

#### **üîß SISTEMA DE DESARROLLO**
- ‚úÖ **Sistema de logs estructurado** - Logger con diferentes niveles
- ‚úÖ **Performance tracking** - M√©tricas de ejecuci√≥n autom√°ticas
- ‚úÖ **Error handling robusto** - Try/catch en todas las capas
- ‚úÖ **Build system** - TypeScript compilation sin errores
- ‚úÖ **Development tools** - ESLint, TypeDoc, Jest configurados

### En DESARROLLO ACTIVO v1.6.4
- ‚úÖ **TODAS LAS TAREAS IMPLEMENTADAS** - Sistema completo con 70+ herramientas MCP
- ‚úÖ **DOCUMENTACI√ìN COMPLETADA** - README, user-guide y .claude_context actualizados
- üöÄ **PR√ìXIMAS TAREAS AVANZADAS**:
  - **TASK-020** - Smart Money Concepts para trading algor√≠tmico (10h)
  - **TASK-013** - On-chain Data Collection (15h)
  - **TASK-015** - Dual Storage MongoDB Experimental (6h)
  - **TASK-016** - Migraci√≥n MongoDB Completa (8-12h, condicional)
  - **TASK-018 Wyckoff Avanzado** - Composite Man, multi-timeframe (8-10h)
  - **TASK-019 T√©cnico** - Fibonacci, Elliott, Bollinger (8h)
- üìÑ **Documentaci√≥n** - Sistema completo documentado y sincronizado
- üóÉÔ∏è **MongoDB Evaluation** - Dual storage para evaluar beneficios vs complejidad

### NUEVAS FUNCIONALIDADES PLANIFICADAS v1.7.0+
- üí∞ **TASK-020** - Smart Money Concepts para trading algor√≠tmico (10h) - Order blocks, FVG, liquidez
- üîó **TASK-013** - On-chain Data Collection (15h) - Stablecoins, ballenas, exchanges
- üóÉÔ∏è **TASK-015** - Dual Storage MongoDB Experimental (6h) - Evaluar beneficios sin romper sistema
- üîÑ **TASK-016** - Migraci√≥n MongoDB Completa (8-12h) - Solo si TASK-015 exitoso
- üîÆ **TASK-018 Wyckoff Avanzado** - Composite Man, multi-timeframe, causa-efecto (8-10h)
- üìä **TASK-019 T√©cnico** - Fibonacci, Elliott Waves, Bollinger Bands (8h)
- üè¢ **FastAPI Scope** - An√°lisis Macro + ML (77h) - Documentado para desarrollo futuro

### NO EXISTE (no sugerir a√∫n)
- ‚ùå Funciones que requieren API Key
- ‚ùå Trading automatizado
- ‚ùå Gesti√≥n de √≥rdenes
- ‚ùå Portfolio tracking

### Integraci√≥n con Waickoff AI
- Este MCP servir√° como capa de datos para Waickoff
- Mantener separaci√≥n: MCP = datos, Waickoff = inteligencia
- Futuro: m√∫ltiples MCPs (Binance, etc.) alimentando Waickoff

### WORKFLOW v1.6.4 para BUGS CR√çTICOS:
1. **Detectar y documentar** en `claude/bugs/bug-XXX-description.md`
2. **Analizar root cause** con detalles t√©cnicos
3. **Implementar fix** siguiendo arquitectura actual
4. **Actualizar logs** con cambios realizados
5. **Crear tests** para evitar regresi√≥n (TASK-004 urgente)
6. **Compilar y validar** antes de declarar resuelto

### WORKFLOW v1.6.4 para DESARROLLO MODULAR (ACTUALIZADO):
1. **Leer arquitectura**: Este archivo + `claude/master-log.md` para estado actual
2. **Identificar capa/servicio**: Presentation/Core/Service/Utility
3. **Para nuevos servicios**: Crear interfaces primero (`I*Service`)
4. **Modularizar si es complejo**: Dividir en servicios especializados (como Storage)
5. **Seguir delegation pattern**: Para handlers MCP
6. **Testing modular**: Cada servicio debe ser mockeable
7. **Compilar y validar**: TypeScript + tests antes de declarar completado

### REGLAS C√ìDIGO v1.6.4 (ARQUITECTURA MODULAR - OBLIGATORIO):

### ‚ö†Ô∏è REGLAS CR√çTICAS DE DOCUMENTACI√ìN:
1. **NO CREAR DOCUMENTACI√ìN** sin visto bueno expl√≠cito del usuario
2. **NO INVENTAR FUNCIONALIDAD** - Siempre analizar c√≥digo existente primero
3. **VERIFICAR COMPILACI√ìN** antes de declarar algo como completado
4. **PREGUNTAR ANTES DE ASUMIR** - Si algo no est√° claro, preguntar
5. **C√ìDIGO PRIMERO** - La implementaci√≥n es la prioridad, no la documentaci√≥n

### REGLAS C√ìDIGO v1.6.4 (ARQUITECTURA MODULAR - OBLIGATORIO):
1. **TypeScript estricto** - Tipos definidos, interfaces implementadas
2. **Dependency injection** - Servicios inyectados por constructor
3. **Interface segregation** - Implementar `I*Service` interfaces
4. **Performance monitoring** - Wrapper autom√°tico en servicios
5. **Error handling** - Try/catch en todas las funciones
6. **Separation of concerns** - Cada clase una responsabilidad
7. **Backward compatibility** - No romper APIs MCP existentes
8. **Documentation** - JSDoc en interfaces y m√©todos p√∫blicos
9. **Modularizaci√≥n** - Si un servicio > 300 l√≠neas, considerar dividirlo
10. **Path normalization** - Siempre normalizar a forward slashes para patterns

### Comandos de desarrollo (v1.6.4):
```bash
npm run build      # Compilar TypeScript modular
npm run dev        # Modo desarrollo con watch
npm start          # Ejecutar MCP compilado
npm run clean      # Limpiar build
npm run test       # Ejecutar tests unitarios (TASK-004)
npm run lint       # Verificar c√≥digo con ESLint
npm run docs       # Generar documentaci√≥n con TypeDoc
```

### Configuraci√≥n Claude Desktop:
```json
{
  "mcpServers": {
    "waickoff-mcp": {
      "command": "node",
      "args": ["D:\\projects\\mcp\\waickoff_mcp\\build\\index.js"],
      "env": {}
    }
  }
}
```

### FILOSOF√çA v1.6.5 (MODULARIDAD + PRODUCTION READY):
- **"Divide y vencer√°s"** - Servicios especializados sobre monolitos
- **"Pattern matching robusto"** - Cross-platform sin sorpresas
- **"Zero Errors UX"** - Claude Desktop sin errores molestos
- **"Testeable por dise√±o"** - Cada m√≥dulo independiente
- **"Ready for Scale"** - Arquitectura que crece sin dolor
- **"Separation of Concerns"** - Cada servicio una responsabilidad
- **"User Experience First"** - Funcionalidad robusta sin fricci√≥n
- **"Documentation First"** - Sistema completamente documentado

## üéØ ENFOQUE ACTUAL v1.6.5: SISTEMA COMPLETO Y DOCUMENTADO
**‚úÖ TASK-019 COMPLETADA**: Errores compilaci√≥n resueltos + documentaci√≥n actualizada
**‚úÖ DOCUMENTACI√ìN SINCRONIZADA**: README, user-guide, .claude_context actualizados
**‚úÖ SISTEMA MODULAR**: 93.3% reducci√≥n archivo principal, corrupci√≥n eliminada
**üéØ 70+ HERRAMIENTAS OPERATIVAS**: Sistema completo con todas las funcionalidades
**üîÆ PR√ìXIMA DECISI√ìN**: Funcionalidades avanzadas (TASK-020, TASK-013, Wyckoff Avanzado)

**REFERENCIAS CR√çTICAS v1.6.5**: 
- **Documentaci√≥n principal**: `README.md` (v1.6.5 actualizado)
- **Gu√≠a de usuario**: `claude/docs/user-guide.md` (70+ herramientas)
- **Contexto proyecto**: `.claude_context` (este archivo)
- **Master log**: `claude/master-log.md` (estado completo)
- **Task tracker**: `claude/tasks/task-tracker.md` (todas las tareas)
- **Arquitectura**: `claude/docs/architecture/system-overview.md`
- **Core engine**: `src/core/engine.ts` (production-ready)
- **MCP modular**: `src/adapters/mcp.ts` (3.6KB vs 55KB original)

## üìã OBLIGATORIO AL TERMINAR CUALQUIER TRABAJO (v1.6.5):
1. **Actualizar documentaci√≥n principal** - README.md con nueva funcionalidad
2. **Actualizar user-guide** - Nuevas herramientas MCP con ejemplos
3. **Actualizar .claude_context** - Estado actual y referencias cr√≠ticas
4. **Verificar compilaci√≥n** - `npm run build` sin errores TypeScript
5. **Tests unitarios** - Crear/actualizar para nuevos servicios
6. **Performance metrics** - Verificar que funcionen correctamente
7. **Backward compatibility** - Verificar que MCP siga funcionando
8. **Documentar decisiones** - En master-log.md y task-tracker.md
9. **Tipos centralizados** - Actualizar `src/types/index.ts` si necesario
10. **Path normalization** - Verificar consistencia cross-platform

**üéÜ SISTEMA v1.6.5 - COMPLETO Y DOCUMENTADO**

**‚úÖ TASK-019 COMPLETADA**: Errores compilaci√≥n TypeScript resueltos completamente
**üìö DOCUMENTACI√ìN COMPLETA**: README, user-guide, .claude_context sincronizados
**üï∞Ô∏è 70+ HERRAMIENTAS MCP**: Sistema completo con todas las funcionalidades
**üèóÔ∏è ARQUITECTURA MODULAR**: 93.3% reducci√≥n archivo principal, corrupci√≥n eliminada
**üöÄ PRODUCTION READY**: Sistema 100% operativo, estable y escalable

---

## üìà Estado Actual del Proyecto

### üìä ESTADO ACTUAL del proyecto

**Fecha:** 11/06/2025
**Versi√≥n:** v1.6.5
**Fase:** TASK-019 COMPLETADA - Errores Compilaci√≥n Resueltos + Documentaci√≥n Actualizada
**Completado:** 100% Core + 100% Storage + 100% Tests + 100% Configuration + 100% Historical + 100% Wyckoff + 100% Traps + 100% Documentaci√≥n
**Nuevo:** Sistema completo documentado con 70+ herramientas MCP y compilaci√≥n exitosa

### ‚úÖ Completado (Sistema Completo v1.6.5)
- **‚úÖ An√°lisis de mercado completo** - Ticker, orderbook, klines en tiempo real
- **‚úÖ An√°lisis t√©cnico avanzado** - Volatilidad, volumen, Volume Delta, S/R din√°micos
- **‚úÖ Grid trading inteligente** - Sugerencias basadas en volatilidad y contexto de mercado
- **‚úÖ An√°lisis Wyckoff b√°sico** - 15 fases, springs, upthrusts, tests, 7 herramientas MCP
- **‚úÖ Detecci√≥n de trampas** - Bull/bear traps, an√°lisis multi-se√±al, 7 herramientas MCP
- **‚úÖ An√°lisis hist√≥rico** - S/R hist√≥rico, anomal√≠as volumen, ciclos, 6 herramientas MCP
- **‚úÖ Sistema storage completo** - Auto-save, repositorio, reportes, cache inteligente
- **‚úÖ Sistema configuraci√≥n** - Timezone, .env cross-platform, MongoDB, API config
- **‚úÖ Arquitectura modular MCP** - 93.3% reducci√≥n archivo principal, corrupci√≥n eliminada
- **‚úÖ Tests unitarios completos** - 100+ test cases, 8 categor√≠as, prevenci√≥n regresi√≥n
- **‚úÖ Documentaci√≥n completa** - README, user-guide, .claude_context sincronizados
- **‚úÖ Sistema de logs y debugging** - Production-ready, troubleshooting completo
- **‚úÖ Integraci√≥n Claude Desktop** - Configuraci√≥n documentada, 70+ herramientas MCP
- **‚úÖ Cross-platform support** - Windows, Linux, macOS, Docker compatible
- **‚úÖ Type safety completa** - 0 errores TypeScript, compilaci√≥n exitosa
- **‚úÖ Performance optimizado** - Cache TTL, delegation pattern, monitoring integrado

### üöß En Progreso

**TASK-019 COMPLETADA** - Errores compilaci√≥n resueltos + documentaci√≥n actualizada
**Sistema 100% estable** - Listo para nuevas funcionalidades avanzadas

### ‚è≥ Pendiente (Funcionalidades Avanzadas - Ordenado por Prioridad)
- **TASK-020**: Smart Money Concepts (10h) - Order blocks, FVG, liquidez - PRIORIDAD ALTA
- **TASK-013**: On-chain data collection (15h) - Stablecoins, ballenas, exchanges
- **TASK-018 Wyckoff Avanzado**: Composite Man, multi-timeframe (8-10h)
- **TASK-019 T√©cnico**: Fibonacci, Elliott Waves, Bollinger (8h)
- **TASK-015**: Dual Storage MongoDB experimental (6h)
- **TASK-006**: Order Flow Imbalance (3h) - Desequilibrios en orderbook
- **TASK-007**: Market Profile b√°sico (5h) - Distribuci√≥n de volumen por precio
- **TASK-016**: Migraci√≥n completa MongoDB (8-12h, condicional)

---

## üìä Arquitectura Actual

### **Stack Tecnol√≥gico**
```
Language: TypeScript
Runtime: Node.js
Protocol: Model Context Protocol (MCP)
API: Bybit v5 (endpoints p√∫blicos)
Dependencies: @modelcontextprotocol/sdk, node-fetch
```

### **Principios Arquitect√≥nicos**
- **Datos p√∫blicos √∫nicamente** - No requiere API keys (por ahora)
- **Modular y extensible** - F√°cil agregar nuevas funciones
- **Separaci√≥n de responsabilidades** - MCP = datos, no trading
- **Error handling robusto** - Manejo de errores en todas las funciones

### **Integraci√≥n con Waickoff AI**
- Este MCP es la capa de datos para wAIckoff AI
- wAIckoff AI usar√° estos datos para an√°lisis con LLMs
- Arquitectura preparada para m√∫ltiples exchanges
- Storage system para contexto hist√≥rico compartido

---

## üîÑ Decisiones T√©cnicas Clave

### **¬øPor qu√© no usar API Keys todav√≠a?**
- Permite uso inmediato sin configuraci√≥n
- Suficiente para an√°lisis t√©cnico y grid trading
- API keys se agregar√°n en v2.0 para funciones avanzadas

### **¬øPor qu√© Volume Delta aproximado?**
- Sin API key no tenemos trades individuales
- Aproximaci√≥n basada en posici√≥n del cierre es suficientemente precisa
- Permite detectar divergencias y tendencias principales

### **¬øPor qu√© TypeScript?**
- Type safety para evitar errores
- Mejor integraci√≥n con MCP SDK
- Facilita mantenimiento y extensi√≥n

---

## üìà M√©tricas de Progreso

| Componente | Estado | Progreso | Notas |
|------------|--------|----------|-------|
| Core Functions | ‚úÖ | 100% | Ticker, orderbook, klines |
| Grid Trading | ‚úÖ | 100% | Sugerencias inteligentes |
| Volume Analysis | ‚úÖ | 100% | VWAP y an√°lisis tradicional |
| Volume Delta | ‚úÖ | 100% | Con detecci√≥n de divergencias |
| Support/Resistance | ‚úÖ | 100% | Niveles din√°micos con scoring |
| Modular Architecture | ‚úÖ | 100% | Sistema de handlers reparado |
| Storage System | ‚úÖ | 100% | Storage + Cache + Repository + Reports |
| Tests System | ‚úÖ | 100% | 100+ test cases implementados |
| Configuration System | ‚úÖ | 100% | Timezone persistente con auto-detecci√≥n |
| Historical Analysis | ‚úÖ | 100% | Sistema completo con 6 herramientas |
| Wyckoff B√°sico | ‚úÖ | 100% | 15 fases, 7 herramientas |
| Detecci√≥n Trampas | ‚úÖ | 100% | Bull/bear traps, 7 herramientas |
| Sistema Modular MCP | ‚úÖ | 100% | 93.3% reducci√≥n, corrupci√≥n eliminada |
| Documentaci√≥n | ‚úÖ | 100% | README, user-guide sincronizados |
| Smart Money Concepts | ‚è≥ | 0% | Pr√≥xima fase |
| API Key Functions | ‚è≥ | 0% | v2.0 planificada |

---

## üéØ PR√ìXIMOS PASOS PRIORIZADOS

### **Completado (Todas las tareas base)**
1. ‚úÖ **TASK-003**: Documentar ADRs de decisiones tomadas - COMPLETADO v1.3.4
2. ‚úÖ **TASK-004**: Crear tests b√°sicos para funciones core - COMPLETADO v1.4.0
3. ‚úÖ **TASK-005**: An√°lisis Wyckoff b√°sico - COMPLETADO v1.6.4
4. ‚úÖ **TASK-009**: Analysis Repository + Report Generator - COMPLETADO v1.4.0
5. ‚úÖ **TASK-010**: Sistema configuraci√≥n timezone - COMPLETADO v1.5.0
6. ‚úÖ **TASK-012**: Detecci√≥n trampas alcistas/bajistas - COMPLETADO v1.6.2
7. ‚úÖ **TASK-015b**: Soporte .env cross-platform - COMPLETADO v1.6.1
8. ‚úÖ **TASK-017**: Sistema An√°lisis Hist√≥rico - COMPLETADO v1.5.1
9. ‚úÖ **TASK-018**: Modularizaci√≥n MCP completa - COMPLETADO v1.6.3
10. ‚úÖ **TASK-019**: Errores compilaci√≥n + documentaci√≥n - COMPLETADO v1.6.4

### **Pr√≥xima Fase (Funcionalidades Avanzadas)**
1. **TASK-020**: Smart Money Concepts para trading algor√≠tmico (10h) - PRIORIDAD ALTA
2. **TASK-013**: On-chain data collection (15h) - Stablecoins, ballenas, exchanges
3. **TASK-018**: Wyckoff Avanzado: Composite Man, multi-timeframe (8-10h)
4. **TASK-019**: Herramientas t√©cnicas: Fibonacci, Elliott, Bollinger (8h)
5. **TASK-015**: Dual Storage MongoDB experimental (6h)

### **Largo Plazo (v2.0+)**
1. Implementar funciones con API Key (orden management, trading autom√°tico)
2. Agregar m√°s exchanges (Binance MCP, Coinbase)
3. Sistema de alertas y notificaciones
4. Integraci√≥n completa con Waickoff AI
5. FastAPI scope: An√°lisis macro y ML (77h)

---

## üîç Contexto para Claude/Cursor v1.6.4

### **Archivos Clave para Entender el Proyecto POST-TASK-019**
1. `claude/master-log.md` - **ESTADO ACTUAL** (logs completos v1.6.4)
2. `.claude_context` - **ESTE ARCHIVO** (reglas y estado actualizado)
3. `README.md` - **DOCUMENTACI√ìN PRINCIPAL** (v1.6.4 actualizada)
4. `claude/docs/user-guide.md` - **GU√çA COMPLETA** (70+ herramientas)
5. `claude/tasks/task-tracker.md` - **TAREAS FUTURAS** (funcionalidades avanzadas)
6. `claude/docs/architecture/system-overview.md` - **ARQUITECTURA** (sistema completo)
7. `src/types/index.ts` - **TIPOS CENTRALIZADOS** (TypeScript definitions)
8. `src/core/engine.ts` - **CORE ENGINE** (protocol-agnostic)
9. `src/adapters/mcp.ts` - **MCP MODULAR** (3.6KB vs 55KB original)
10. `claude/docs/api/tools-reference.md` - **REFERENCIA API** (herramientas completas)

### **C√≥mo Contribuir en v1.6.5 (Sistema Completo Documentado)**
1. **Leer documentaci√≥n cr√≠tica**: Este archivo + `README.md` + `master-log.md`
2. **Revisar user-guide**: 70+ herramientas MCP implementadas y documentadas
3. **Entender arquitectura modular**: Sistema completamente reparado y optimizado
4. **Revisar task-tracker**: Pr√≥ximas funcionalidades avanzadas planificadas
5. **Identificar capa correcta**: Presentation/Core/Service/Utility layers
6. **Seguir delegation pattern**: MCPHandlers ‚Üí Handler especializado ‚Üí Engine
7. **Implementar interfaces**: `I*Service` patterns bien establecidos
8. **Agregar performance monitoring**: M√©tricas autom√°ticas integradas
9. **Testing modular**: Cada handler mockeable independientemente
10. **Actualizar documentaci√≥n**: Mantener sincronizaci√≥n entre archivos
11. **Compilar y validar**: TypeScript + tests antes de declarar completado
12. **Verificar backwards compatibility**: Sistema debe seguir funcionando

---

## üí° Lecciones Aprendidas

1. **Volume Delta sin API key es posible** - La aproximaci√≥n basada en precio es suficiente
2. **VWAP es cr√≠tico para grid trading** - Indica zonas de equilibrio
3. **Divergencias son se√±ales tempranas** - Detectan reversiones antes que el precio
4. **Modularidad es clave** - Facilita agregar funciones sin romper existentes
5. **Support/Resistance con scoring multi-factor es altamente efectivo** - Combinar toques, volumen, proximidad y antig√ºedad da niveles muy precisos
6. **Pivots din√°micos superan niveles est√°ticos** - Algoritmo de lookback ajustable permite detecci√≥n optimizada
7. **Agrupaci√≥n de niveles evita ruido** - Tolerancia del 0.5% consolida pivots cercanos en niveles significativos
8. **Archivos corruptos requieren reconstrucci√≥n completa** - No intentar parches, rebuilding from scratch es m√°s efectivo
9. **Delegation pattern es superior a handlers monol√≠ticos** - Especializaci√≥n por dominio mejora mantenibilidad exponencialmente
10. **Pattern matching requiere normalizaci√≥n de paths** - Siempre convertir a forward slashes para consistencia cross-platform
11. **Modularizaci√≥n facilita debugging** - Bug de StorageService resuelto creando servicios especializados
12. **Evaluar antes de migrar** - Dual storage pattern permite evaluar MongoDB sin romper sistema actual
13. **Documentaci√≥n sincronizada es cr√≠tica** - README, user-guide y .claude_context deben estar alineados
14. **Compilaci√≥n limpia es fundamental** - 0 errores TypeScript facilita desarrollo futuro
15. **Sistema modular elimina corrupci√≥n** - 93.3% reducci√≥n archivo principal resuelve problema permanentemente

---

## üöÄ Visi√≥n del Proyecto

**Corto Plazo**: Sistema MCP completo y documentado con an√°lisis t√©cnico profesional
**Medio Plazo**: Funcionalidades avanzadas (SMC, Wyckoff Avanzado, On-chain)
**Largo Plazo**: Integraci√≥n completa con Waickoff AI + Suite MCPs m√∫ltiples exchanges

---

*Este contexto se actualiza en cada sesi√≥n significativa de desarrollo.*

#### **üì¶ TASK-009 STORAGE SYSTEM (100% COMPLETO)**
- ‚úÖ **FASE 1: StorageService Base** - Operaciones CRUD funcionando
- ‚úÖ **FASE 2: Cache Manager** - In-memory cache con TTL y LRU
- ‚úÖ **FASE 3: Analysis Repository** - 7 herramientas MCP operativas:
  - `get_analysis_by_id` - Buscar por UUID
  - `get_latest_analysis` - √öltimo an√°lisis por tipo
  - `search_analyses` - B√∫squeda compleja
  - `get_analysis_summary` - Resumen agregado
  - `get_aggregated_metrics` - M√©tricas estad√≠sticas
  - `find_patterns` - Buscar patrones
  - `get_repository_stats` - Estad√≠sticas del repo
- ‚úÖ **FASE 4: Report Generator** - 8 herramientas MCP operativas:
  - `generate_report` - Generar reporte personalizado
  - `generate_daily_report` - Reporte diario autom√°tico
  - `generate_weekly_report` - Reporte semanal
  - `generate_symbol_report` - Reporte por s√≠mbolo
  - `generate_performance_report` - An√°lisis de rendimiento
  - `get_report` - Obtener reporte por ID
  - `list_reports` - Listar reportes disponibles
  - `export_report` - Exportar reporte a archivo

#### **üîç SISTEMA DE LOGGING Y DEBUGGING OPTIMIZADO**
- ‚úÖ **API Statistics b√°sicos** - Total requests, errors, success rate en memoria
- ‚úÖ **Error tracking simple** - √öltimos 5 errores con timestamp
- ‚úÖ **Connection monitoring** - Status HTTP, timeouts, parsing errors
- ‚úÖ **Zero complex objects** - Eliminados objetos que causaban errores JSON
- ‚úÖ **Claude Desktop compatible** - Sin errores molestos en UI
- ‚úÖ **Performance b√°sico** - Duraci√≥n de requests sin overhead
- ‚úÖ **Essential debugging** - Solo lo necesario para troubleshooting
- ‚úÖ **Production ready** - Sistema estable sin logs verbosos

#### **üìä FUNCIONALIDADES DE AN√ÅLISIS**
- ‚úÖ **Market Data Service** - Ticker, orderbook, klines con error handling
- ‚úÖ **Technical Analysis Service** - Volatilidad, volumen, Volume Delta, S/R
- ‚úÖ **Trading Service** - Grid trading inteligente basado en volatilidad
- ‚úÖ **Support/Resistance avanzado** - Algoritmo multi-factor con scoring
- ‚úÖ **Volume Delta aproximado** - Presi√≥n compradora/vendedora sin API key
- ‚úÖ **Divergence detection** - Detecci√≥n temprana de reversiones
- ‚úÖ **VWAP integration** - An√°lisis de valor promedio ponderado

#### **üîß SISTEMA DE DESARROLLO**
- ‚úÖ **Sistema de logs estructurado** - Logger con diferentes niveles
- ‚úÖ **Performance tracking** - M√©tricas de ejecuci√≥n autom√°ticas
- ‚úÖ **Error handling robusto** - Try/catch en todas las capas
- ‚úÖ **Build system** - TypeScript compilation sin errores
- ‚úÖ **Development tools** - ESLint, TypeDoc, Jest configurados

### En DESARROLLO ACTIVO v1.4.0
- ‚úÖ **TASK-009 COMPLETADA** - Sistema Storage completo con 4 fases implementadas
- ‚úÖ **TASK-004 COMPLETADA** - Tests unitarios configurados y funcionando
- üöÄ **PR√ìXIMAS TAREAS**:
  - **TASK-012** - Detecci√≥n Trampas Alcistas/Bajistas (7h)
  - **TASK-013** - On-chain Data Collection (15h)
  - **TASK-015** - Dual Storage MongoDB Experimental (6h)
  - **TASK-016** - Migraci√≥n MongoDB Completa (8-12h, condicional)
  - **TASK-010** - Sistema Configuraci√≥n Timezone (4h)
- üìÑ **Documentaci√≥n** - Sistema completo documentado y listo
- üóÉÔ∏è **MongoDB Evaluation** - Dual storage para evaluar beneficios vs complejidad

### NUEVAS FUNCIONALIDADES PLANIFICADAS v1.4.0
- üéØ **TASK-012** - Detecci√≥n Trampas Alcistas/Bajistas (7h) - Bull/bear trap detection
- üîó **TASK-013** - On-chain Data Collection (15h) - Stablecoins, ballenas, exchanges
- üóÉÔ∏è **TASK-015** - Dual Storage MongoDB Experimental (6h) - Evaluar beneficios sin romper sistema
- üîÑ **TASK-016** - Migraci√≥n MongoDB Completa (8-12h) - Solo si TASK-015 exitoso
- üìù **TASK-010** - Sistema Configuraci√≥n Timezone (4h) - Eliminar friction temporal
- üè¢ **FastAPI Scope** - An√°lisis Macro + ML (77h) - Documentado para desarrollo futuro

### NO EXISTE (no sugerir a√∫n)
- ‚ùå Funciones que requieren API Key
- ‚ùå Trading automatizado
- ‚ùå Gesti√≥n de √≥rdenes
- ‚ùå Portfolio tracking

### Integraci√≥n con Waickoff AI
- Este MCP servir√° como capa de datos para Waickoff
- Mantener separaci√≥n: MCP = datos, Waickoff = inteligencia
- Futuro: m√∫ltiples MCPs (Binance, etc.) alimentando Waickoff

### WORKFLOW v1.3.9 para BUGS CR√çTICOS:
1. **Detectar y documentar** en `claude/bugs/bug-XXX-description.md`
2. **Analizar root cause** con detalles t√©cnicos
3. **Implementar fix** siguiendo arquitectura actual
4. **Actualizar logs** con cambios realizados
5. **Crear tests** para evitar regresi√≥n (TASK-004 urgente)
6. **Compilar y validar** antes de declarar resuelto

### WORKFLOW v1.3.9 para DESARROLLO MODULAR (ACTUALIZADO):
1. **Leer arquitectura**: Este archivo + `claude/master-log.md` para estado actual
2. **Identificar capa/servicio**: Presentation/Core/Service/Utility
3. **Para nuevos servicios**: Crear interfaces primero (`I*Service`)
4. **Modularizar si es complejo**: Dividir en servicios especializados (como Storage)
5. **Seguir delegation pattern**: Para handlers MCP
6. **Testing modular**: Cada servicio debe ser mockeable
7. **Compilar y validar**: TypeScript + tests antes de declarar completado

### REGLAS C√ìDIGO v1.3.9 (ARQUITECTURA MODULAR - OBLIGATORIO):

### ‚ö†Ô∏è REGLAS CR√çTICAS DE DOCUMENTACI√ìN:
1. **NO CREAR DOCUMENTACI√ìN** sin visto bueno expl√≠cito del usuario
2. **NO INVENTAR FUNCIONALIDAD** - Siempre analizar c√≥digo existente primero
3. **VERIFICAR COMPILACI√ìN** antes de declarar algo como completado
4. **PREGUNTAR ANTES DE ASUMIR** - Si algo no est√° claro, preguntar
5. **C√ìDIGO PRIMERO** - La implementaci√≥n es la prioridad, no la documentaci√≥n

### REGLAS C√ìDIGO v1.3.8 (ARQUITECTURA MODULAR - OBLIGATORIO):
1. **TypeScript estricto** - Tipos definidos, interfaces implementadas
2. **Dependency injection** - Servicios inyectados por constructor
3. **Interface segregation** - Implementar `I*Service` interfaces
4. **Performance monitoring** - Wrapper autom√°tico en servicios
5. **Error handling** - Try/catch en todas las funciones
6. **Separation of concerns** - Cada clase una responsabilidad
7. **Backward compatibility** - No romper APIs MCP existentes
8. **Documentation** - JSDoc en interfaces y m√©todos p√∫blicos
9. **Modularizaci√≥n** - Si un servicio > 300 l√≠neas, considerar dividirlo
10. **Path normalization** - Siempre normalizar a forward slashes para patterns

### Comandos de desarrollo (v1.3.9):
```bash
npm run build      # Compilar TypeScript modular
npm run dev        # Modo desarrollo con watch
npm start          # Ejecutar MCP compilado
npm run clean      # Limpiar build
npm run test       # Ejecutar tests unitarios (TASK-004)
npm run lint       # Verificar c√≥digo con ESLint
npm run docs       # Generar documentaci√≥n con TypeDoc
```

### Configuraci√≥n Claude Desktop:
```json
{
  "mcpServers": {
    "waickoff-mcp": {
      "command": "node",
      "args": ["D:\\projects\\mcp\\waickoff_mcp\\build\\index.js"],
      "env": {}
    }
  }
}
```

### FILOSOF√çA v1.3.9 (MODULARIDAD + PRODUCTION READY):
- **"Divide y vencer√°s"** - Servicios especializados sobre monolitos
- **"Pattern matching robusto"** - Cross-platform sin sorpresas
- **"Zero Errors UX"** - Claude Desktop sin errores molestos
- **"Testeable por dise√±o"** - Cada m√≥dulo independiente
- **"Ready for Scale"** - Arquitectura que crece sin dolor
- **"Separation of Concerns"** - Cada servicio una responsabilidad
- **"User Experience First"** - Funcionalidad robusta sin fricci√≥n

## üéØ ENFOQUE ACTUAL v1.3.9: SISTEMA LIMPIO Y UNIFICADO
**‚úÖ TASK-014 COMPLETADA**: Auto-save legacy eliminado - un solo sistema de guardado
**‚úÖ BUG-004 RESUELTO**: Pattern matching funcionando perfectamente
**‚úÖ STORAGE MODULARIZADO**: FileSystem + PatternMatcher + Config services
**üéØ 7 HERRAMIENTAS OPERATIVAS**: Analysis Repository 100% funcional
**üîÆ PR√ìXIMA DECISI√ìN**: FASE 4 Report Generator vs TASK-012 Bull/Bear Traps

**REFERENCIAS CR√çTICAS v1.3.9**: 
- **Arquitectura completa**: `claude/docs/architecture/system-overview.md`
- **Storage refactorizado**: `src/services/storage/` (nueva estructura)
- **Bug resuelto**: `claude/bugs/bug-004-storage-query-pattern.md`
- **APIs actualizadas**: `claude/docs/api/tools-reference.md`
- **Tipos centralizados**: `src/types/index.ts`
- **Core engine**: `src/core/engine.ts`

## üìã OBLIGATORIO AL TERMINAR CUALQUIER TRABAJO (v1.3.9):
1. **Actualizar tipos centralizados** en `src/types/index.ts` si es necesario
2. **Verificar interfaces** implementadas correctamente
3. **Actualizar documentaci√≥n** de arquitectura si hay cambios estructurales
4. **Crear documentaci√≥n en claude/docs/** para features completadas
5. **Performance metrics** verificar que est√©n funcionando
6. **Tests unitarios** crear/actualizar para nuevos servicios
7. **Backward compatibility** verificar que MCP siga funcionando
8. **Build limpio** sin errores TypeScript
9. **Documentar decisiones** t√©cnicas importantes en logs
10. **Path normalization** verificar consistencia cross-platform

**üéÜ SISTEMA v1.3.9 - C√ìDIGO LIMPIO Y UNIFICADO**

**‚úÖ BUG-004 RESUELTO**: StorageService pattern matching arreglado
**üèóÔ∏è STORAGE MODULARIZADO**: FileSystem + PatternMatcher + Config  
**üí™ 7 HERRAMIENTAS NUEVAS**: Analysis Repository 100% operativo
**üîÆ 85% COMPLETADO**: Solo falta Report Generator para cerrar TASK-009
**üßπ C√ìDIGO LIMPIO**: Auto-save legacy eliminado, un solo sistema de guardado
