# ğŸ¤– Contexto para Claude/Cursor - wAIckoff MCP Server v1.3.7 (PRODUCTION READY)

## ğŸ† ESTADO CRÃTICO v1.3.7 - ARQUITECTURA MODULAR COMPLETAMENTE REPARADA
**âœ… REPARACIÃ“N CRÃTICA COMPLETADA**: Archivo corrupto `mcp-handlers.ts` completamente reconstruido
**âœ… ARQUITECTURA MODULAR**: Sistema de handlers especializados 100% implementado
**ğŸ¯ COMPILACIÃ“N**: 200+ errores TypeScript corregidos â†’ 0 errores
**ğŸš€ PRODUCTION READY**: Base sÃ³lida para TASK-009 FASE 3 + desarrollo continuo

## IMPORTANTE: Leer ANTES de dar cualquier sugerencia

### ğŸ“Š SISTEMA DE TRAZABILIDAD COMPLETA v1.3.4 (OBLIGATORIO)
**âš ï¸ CAMBIO CRÃTICO**: Sistema de logging avanzado implementado - revisar documentaciÃ³n de debugging
**SIEMPRE** revisar y actualizar estos archivos en orden de prioridad:

#### **ğŸ“‹ Archivos CrÃ­ticos de Estado:**
- `claude/master-log.md` - **Estado actual del MCP (LEER PRIMERO)**
- `claude/tasks/task-tracker.md` - PrÃ³ximas funciones a implementar
- `claude/bugs/` - **NUEVA** carpeta con bugs documentados y soluciones
- `claude/lessons-learned/` - **NUEVA** carpeta con lecciones aprendidas crÃ­ticas
- `claude/docs/` - **NUEVA** documentaciÃ³n tÃ©cnica completa de features
- `claude/logs/YYYY-MM-DD.md` - Log diario (ACTUALIZAR al final)

#### **ğŸ“š DocumentaciÃ³n TÃ©cnica:**
- `claude/docs/architecture/system-overview.md` - **NUEVA** arquitectura completa
- `claude/docs/api/tools-reference.md` - **NUEVA** referencia de API
- `claude/docs/troubleshooting/common-issues.md` - **NUEVA** guÃ­a de resoluciÃ³n
- `claude/docs/task-005-auto-save-system.md` - **NUEVA** documentaciÃ³n auto-save
- `claude/docs/task-009-storage-system-complete.md` - **NUEVA** documentaciÃ³n storage completo
- `claude/docs/timezone-system.md` - **NUEVA** documentaciÃ³n sistema timezone
- `claude/docs/timezone-future-recommendations.md` - **NUEVA** recomendaciones timezone
- `claude/decisions/adr-log.md` - Decisiones arquitectÃ³nicas
- `claude/lessons-learned/README.md` - **NUEVA** Ã­ndice de lecciones aprendidas
- `ROADMAP_AVANZADO.md` - VisiÃ³n general de funcionalidades futuras

#### **ğŸ› GestiÃ³n de Bugs:**
- **SISTEMA COMPLETO**: Todos los bugs crÃ­ticos se documentan en `claude/bugs/`
- **Formato**: `bug-XXX-description.md` con anÃ¡lisis completo
- **Registro**: `claude/bugs/README.md` con Ã­ndice y mÃ©tricas
- **Ejemplos**: BUG-001 (S/R classification), BUG-002 (Architecture refactor)

#### **ğŸ“š GestiÃ³n de Lecciones Aprendidas:**
- **SISTEMA NUEVO**: Todas las lecciones crÃ­ticas en `claude/lessons-learned/`
- **Formato**: `lesson-XXX-description.md` con anÃ¡lisis y patterns
- **Registro**: `claude/lessons-learned/README.md` con Ã­ndice y templates
- **Ejemplos**: LESSON-001 (Auto-save implementation failure)

### ğŸ† ESTADO ACTUAL (v1.3.6 - 10/06/2025) - TASK-009 FASE 2 COMPLETADA + MODULARIDAD CORREGIDA
- **Fase:** âœ… CACHE MANAGER FASE 2 + PATRÃ“N MODULAR CORREGIDO
- **Ãšltima ActualizaciÃ³n:** v1.3.6 con Cache Manager + Dependency Injection funcionando
- **PrÃ³xima DecisiÃ³n:** Continuar TASK-009 FASE 3 con sistema completamente modular
- **Bloqueadores:** NINGUNO - CompilaciÃ³n limpia, cache operativo, modularidad aplicada
- **UX Status:** ğŸ† OPTIMIZADO - Performance boost con cache inteligente
- **Funcionalidad:** âœ… Sistema MCP + Storage + Cache + Modularidad 100% operativo

### ğŸ† ARQUITECTURA MODULAR v1.3.7 - COMPLETAMENTE REPARADA Y OPERATIVA
**âœ… REPARACIÃ“N EXITOSA**: Archivo corrupto `mcp-handlers.ts` reconstruido desde cero
**ğŸ—ï¸ DELEGATION PATTERN**: Sistema de handlers especializados implementado correctamente
**ğŸ§ª 100% TESTEABLE**: Cada handler independiente con dependency injection
**ğŸ”„ BACKWARD COMPATIBLE**: Todas las herramientas MCP mantienen funcionalidad
**âœ… CLEAN COMPILATION**: 200+ errores TypeScript â†’ 0 errores

#### **ğŸ¯ CAPAS Y SERVICIOS IMPLEMENTADOS**

#### **ğŸ¢ Presentation Layer (Adapters) - MODULAR SYSTEM**
- âœ… **MCP Adapter** (`src/adapters/mcp.ts`) - Protocolo MCP con routing a handlers
- âœ… **MCPHandlers** (`src/adapters/mcp-handlers.ts`) - Orquestador central con delegation
- âœ… **MarketDataHandlers** (`src/adapters/handlers/marketDataHandlers.ts`) - Handlers especializados
- âœ… **AnalysisRepositoryHandlers** (`src/adapters/handlers/analysisRepositoryHandlers.ts`) - TASK-009 FASE 3
- âœ… **CacheHandlers** (`src/adapters/cacheHandlers.ts`) - Operaciones de cache
- ğŸ”® **REST API Adapter** (Futuro) - FastAPI integration ready
- ğŸ”® **WebSocket Adapter** (Futuro) - Real-time streams
- ğŸ”® **CLI Adapter** (Futuro) - Command line interface

#### **ğŸ§  Core Layer (Business Logic)**
- âœ… **Market Analysis Engine** (`src/core/engine.ts`) - Orquestador principal
- âœ… **System Configuration** - ConfiguraciÃ³n centralizada
- âœ… **Health Monitoring** - Estado del sistema
- âœ… **Performance Tracking** - MÃ©tricas automticas

#### **âš™ï¸ Service Layer (Specialized Services)**
- âœ… **Market Data Service** (`src/services/marketData.ts`) - Bybit API integration
- âœ… **Technical Analysis Service** (`src/services/analysis.ts`) - AnÃ¡lisis tÃ©cnico
- âœ… **Trading Service** (`src/services/trading.ts`) - Grid trading & strategies
- ğŸ”® **Multi-Exchange Services** (Futuro) - Binance, Coinbase, etc.

#### **ğŸ› ï¸ Utility Layer (Common Tools)**
- âœ… **Logger** (`src/utils/logger.ts`) - Sistema de logs estructurado
- âœ… **Performance Monitor** (`src/utils/performance.ts`) - MÃ©tricas de rendimiento
- âœ… **Math Utils** (`src/utils/math.ts`) - Utilidades matemÃ¡ticas
- âœ… **Type Definitions** (`src/types/index.ts`) - Tipos centralizados

#### **ğŸ”¥ PATRÃ“N DE MODULARIDAD v1.3.7 - DELEGATION ARCHITECTURE**

##### **âœ… Sistema de Handlers Especializado**
```typescript
// MCPHandlers actÃºa como coordinador central
export class MCPHandlers {
  private marketDataHandlers: MarketDataHandlers;
  private analysisRepositoryHandlers: AnalysisRepositoryHandlers;
  private cacheHandlers: CacheHandlers;
  
  // Delegation to specialized handlers
  async handleGetTicker(args: any) {
    return await this.marketDataHandlers.handleGetTicker(args);
  }
}
```

##### **âœ… MCP Adapter Simplificado**
- **Eliminado cÃ³digo duplicado**: 2000+ lÃ­neas reducidas a ~500 lÃ­neas limpias
- **Routing limpio**: Switch simple que delega a handlers especializados
- **Mantenimiento sencillo**: Cambios localizados en handlers especÃ­ficos

##### **âœ… Handlers Especializados por Dominio**
- **MarketDataHandlers**: `handleGetTicker`, `handleGetOrderbook`, `handleGetMarketData`
- **AnalysisRepositoryHandlers**: TASK-009 FASE 3 handlers completos
- **CacheHandlers**: `handleGetCacheStats`, `handleClearCache`, `handleInvalidateCache`

### Funcionalidades IMPLEMENTADAS v1.3.7 (SISTEMA MODULAR REPARADO)

#### **ğŸ—ï¸ ARQUITECTURA & INFRAESTRUCTURA**
- âœ… **ğŸ† ARQUITECTURA MODULAR REPARADA** - Sistema de handlers completamente funcional
- âœ… **Delegation pattern** - MCPHandlers coordina handlers especializados
- âœ… **Handlers por dominio** - MarketData, AnalysisRepository, Cache separados
- âœ… **CompilaciÃ³n limpia** - 200+ errores TypeScript corregidos
- âœ… **Separation of concerns** - Cada handler con responsabilidad especÃ­fica
- âœ… **TASK-009 FASE 3 ready** - AnalysisRepositoryHandlers implementados
- âœ… **100% Testeable** - Cada handler mockeable independientemente
- âœ… **Performance optimizado** - Eliminado cÃ³digo duplicado masivo

#### **ğŸ” SISTEMA DE LOGGING Y DEBUGGING OPTIMIZADO**
- âœ… **API Statistics bÃ¡sicos** - Total requests, errors, success rate en memoria
- âœ… **Error tracking simple** - Ãšltimos 5 errores con timestamp
- âœ… **Connection monitoring** - Status HTTP, timeouts, parsing errors
- âœ… **Zero complex objects** - Eliminados objetos que causaban errores JSON
- âœ… **Claude Desktop compatible** - Sin errores molestos en UI
- âœ… **Performance bÃ¡sico** - DuraciÃ³n de requests sin overhead
- âœ… **Essential debugging** - Solo lo necesario para troubleshooting
- âœ… **Production ready** - Sistema estable sin logs verbosos

#### **ğŸ“Š FUNCIONALIDADES DE ANÃLISIS**
- âœ… **Market Data Service** - Ticker, orderbook, klines con error handling
- âœ… **Technical Analysis Service** - Volatilidad, volumen, Volume Delta, S/R
- âœ… **Trading Service** - Grid trading inteligente basado en volatilidad
- âœ… **Support/Resistance avanzado** - Algoritmo multi-factor con scoring
- âœ… **Volume Delta aproximado** - PresiÃ³n compradora/vendedora sin API key
- âœ… **Divergence detection** - DetecciÃ³n temprana de reversiones
- âœ… **VWAP integration** - AnÃ¡lisis de valor promedio ponderado

#### **ğŸ”§ SISTEMA DE DESARROLLO**
- âœ… **Sistema de logs estructurado** - Logger con diferentes niveles
- âœ… **Performance tracking** - MÃ©tricas de ejecuciÃ³n automÃ¡ticas
- âœ… **Error handling robusto** - Try/catch en todas las capas
- âœ… **Build system** - TypeScript compilation sin errores
- âœ… **Development tools** - ESLint, TypeDoc, Jest configurados

### En DESARROLLO ACTIVO v1.3.7
- ğŸš§ **TASK-009 FASE 3** - Analysis Repository (handlers implementados, listo para Core)
- ğŸš§ **Tests unitarios** - Para handlers modularizados (CRÃTICO post-reparaciÃ³n)
- ğŸš§ **DocumentaciÃ³n handlers** - GuÃ­as de uso para sistema modular

### NO EXISTE (no sugerir aÃºn)
- âŒ Funciones que requieren API Key
- âŒ Trading automatizado
- âŒ GestiÃ³n de Ã³rdenes
- âŒ Portfolio tracking

### IntegraciÃ³n con Waickoff AI
- Este MCP servirÃ¡ como capa de datos para Waickoff
- Mantener separaciÃ³n: MCP = datos, Waickoff = inteligencia
- Futuro: mÃºltiples MCPs (Binance, etc.) alimentando Waickoff

### WORKFLOW v1.3.0 para BUGS CRÃTICOS:
1. **Detectar y documentar** en `claude/bugs/bug-XXX-description.md`
2. **Analizar root cause** con detalles tÃ©cnicos
3. **Implementar fix** siguiendo arquitectura actual
4. **Actualizar logs** con cambios realizados
5. **Crear tests** para evitar regresiÃ³n (TASK-004 urgente)
6. **Compilar y validar** antes de declarar resuelto

### WORKFLOW v1.3.7 para DESARROLLO MODULAR (ACTUALIZADO):
1. **Leer arquitectura**: Este archivo + `claude/master-log.md` para estado actual
2. **Identificar handler**: MarketData, AnalysisRepository, Cache, o nuevo dominio
3. **Seguir delegation pattern**: MCPHandlers â†’ Handler especializado â†’ Engine
4. **Crear handler especializado**: Si es nuevo dominio, seguir pattern existente
5. **Actualizar MCPAdapter**: Agregar routing en switch statement
6. **Testing modular**: Cada handler debe ser mockeable independientemente
7. **Compilar y validar**: TypeScript + tests antes de declarar completado

### REGLAS CÃ“DIGO v1.3.0 (ARQUITECTURA MODULAR - OBLIGATORIO):

### âš ï¸ REGLAS CRÃTICAS DE DOCUMENTACIÃ“N:
1. **NO CREAR DOCUMENTACIÃ“N** sin visto bueno explÃ­cito del usuario
2. **NO INVENTAR FUNCIONALIDAD** - Siempre analizar cÃ³digo existente primero
3. **VERIFICAR COMPILACIÃ“N** antes de declarar algo como completado
4. **PREGUNTAR ANTES DE ASUMIR** - Si algo no estÃ¡ claro, preguntar
5. **CÃ“DIGO PRIMERO** - La implementaciÃ³n es la prioridad, no la documentaciÃ³n

### REGLAS CÃ“DIGO v1.3.0 (ARQUITECTURA MODULAR - OBLIGATORIO):
1. **TypeScript estricto** - Tipos definidos, interfaces implementadas
2. **Dependency injection** - Servicios inyectados por constructor
3. **Interface segregation** - Implementar `I*Service` interfaces
4. **Performance monitoring** - Wrapper automÃ¡tico en servicios
5. **Error handling** - Try/catch en todas las funciones
6. **Separation of concerns** - Cada clase una responsabilidad
7. **Backward compatibility** - No romper APIs MCP existentes
8. **Documentation** - JSDoc en interfaces y mÃ©todos pÃºblicos

### Comandos de desarrollo (v1.3.0):
```bash
npm run build      # Compilar TypeScript modular
npm run dev        # Modo desarrollo con watch
npm start          # Ejecutar MCP compilado
npm run clean      # Limpiar build
npm rwaickoff_mcp     # Ejecutar tests unitarios (TASK-004)
npm run lint       # Verificar cÃ³digo con ESLint
npm run docs       # Generar documewaickoff_mcpypeDoc
```

### ConfiguraciÃ³n Claude Desktop:
```json
{
  "mcpServers": {
    "waickoff-mcp": {
      "command": "node",
      "args": ["D:\\projects\\mcp\\waickoff_mcp\\build\\index.js"],
      "env": {}
    }
  }
}
```

### FILOSOFÃA v1.3.4 (LOGGING MINIMALISTA - PRODUCTION READY):
- **"De Logging Complejo a Simplicidad Efectiva"** - Solo lo esencial para debugging
- **"Zero Errors UX - Production Quality"** - Claude Desktop completamente limpio
- **"Minimal Overhead - Maximum Stability"** - Performance optimizado sin logs verbosos
- **"Essential Debugging - No Complex Objects"** - API stats bÃ¡sicos + Error tracking simple
- **"Ready for Integration"** - Base sÃ³lida para Waickoff AI sin interferencias
- **"Separation of Concerns"** - Logging interno vs protocolo externo separados
- **"User Experience First"** - TÃ©cnicos contentos, usuarios sin errores molestos

## ğŸ¯ ENFOQUE ACTUAL v1.3.5: BUG-003 DEFINITIVAMENTE RESUELTO + SISTEMA PRODUCTION-READY
**âœ… PROBLEMA CRÃTICO RESUELTO**: Errores JSON startup eliminados 100% - Claude Desktop perfectamente limpio
**âš¡ SOLUCIÃ“N ROBUSTA**: Console override completo + Silent startup + Logging diferido
**ğŸš€ PRODUCTION QUALITY**: Base sÃ³lida sin interferencias para desarrollo continuo

**REFERENCIAS CRÃTICAS v1.3.0**: 
- **Arquitectura completa**: `claude/docs/architecture/system-overview.md`
- **RefactorizaciÃ³n**: `claude/bugs/bug-002-modular-architecture.md`
- **APIs actualizadas**: `claude/docs/api/tools-reference.md`
- **Tipos centralizados**: `src/types/index.ts`
- **Core engine**: `src/core/engine.ts`

## ğŸ“‹ OBLIGATORIO AL TERMINAR CUALQUIER TRABAJO (v1.3.0):
1. **Actualizar tipos centralizados** en `src/types/index.ts` si es necesario
2. **Verificar interfaces** implementadas correctamente
3. **Actualizar documentaciÃ³n** de arquitectura si hay cambios estructurales
4. **Crear documentaciÃ³n en claude/docs/** para features completadas (TASK-005, TASK-009, etc)
5. **Performance metrics** verificar que estÃ©n funcionando
6. **Tests unitarios** crear/actualizar para nuevos servicios
7. **Backward compatibility** verificar que MCP siga funcionando
8. **Build limpio** sin errores TypeScript
9. **Documentar decisiones** tÃ©cnicas importantes en logs

**ğŸ† SISTEMA v1.3.7 - ARQUITECTURA MODULAR COMPLETAMENTE REPARADA**

**âœ… REPARACIÃ“N CRÃTICA COMPLETADA**: Archivo corrupto `mcp-handlers.ts` reconstruido desde cero
**ğŸ—ï¸ DELEGATION PATTERN IMPLEMENTADO**: Sistema de handlers especializados 100% funcional  
**ğŸ’ª COMPILACIÃ“N LIMPIA**: 200+ errores TypeScript â†’ 0 errores
**ğŸ”® BASE SÃ“LIDA**: Lista para TASK-009 FASE 3 + desarrollo continuo