IMPORTANTE LEER Y HACER CASO (no eliminar):
- EN LAS TAREAS HAZ PAUSAS DE VEZ EN CUANDO, ESTO NOS SERVIRÃ PARA VERIFICACIONES Y QUE EL CHAT NO FINALICE ABRUPTAMENTE Y QUEDEN ARCHIVOS CORRUPTOS O FUERA DE CONTEXTO
- NO CREAS FIXES PARA EJECUTAR, PARA ESTO ESTÃ MCP FILESYSTE
- NO CREES DOCUMENTOS TIPO DOCKER_COMMANDS O REBUILD_AND_TEST SI NO TE LO PIDO, ESO SOLO NOS QUITA ESPACIO DE CHAT Y TIEMPO.
- NO CREAS SCRIPTS DE PRUEBA, EL SISTEMA ESTÃ EN DOCKER. EL USUARIO HACE LAS PRUEBAS Y TE MUESTRA LOS ERRORES
- USAS REQUIRIMENTS.TXT SIN VERSIONES, NO QUEREMOS USAR VERSIONES ANTIGUAS
- LOS DOCUMENTOS TÃ‰CNICOS DESPUÃ‰S DE CADA FASE VAN EN CLAUDE/DOCS !!!!


# ğŸ¤– Cloud MarketData MCP Server - Contexto MÃ­nimo v0.1.4

## ğŸ“‹ Estado Actual
- **VersiÃ³n:** v0.1.4
- **Fecha:** 14/06/2025
- **Status:** En Desarrollo - Debug Storage Issue
- **Ãšltima tarea:** TASK-002A: WebSocket Collector Base + Bybit Trades - COMPLETADA (pero trades no se almacenan)
- **Issue actual:** Collector recibe 4032+ mensajes pero storage muestra 0 trades
- **PrÃ³xima tarea:** La siguiente es TASK-002B (Planning Binance) - 1.5h

## ğŸ¯ Objetivo del Proyecto
Microservicio robusto y escalable para la recopilaciÃ³n, procesamiento y almacenamiento de datos de mercado en tiempo real (Bybit/Binance) para nutrir indicadores de Order Flow y Volume Profile. DiseÃ±ado como el primer componente de la futura **wAIckoff Platform** con IA y dashboard.

## ğŸ—ï¸ Arquitectura Propuesta
- **Stack**: Python 3.12-slim + FastAPI + FastMCP + MongoDB + Redis + Celery
- **PatrÃ³n**: Clean Architecture con 4 capas + Event-Driven
- **Deployment**: Docker Compose para desarrollo, preparado para K8s y multi-VPS
- **APIs**: WebSocket Bybit v5 + Binance para trades y orderbook
- **Futuro**: Preparado para evolucionar a plataforma completa (app.waickoff.com, api.waickoff.com, ai.waickoff.com)

## ğŸ“Š Funcionalidades Core
1. **RecopilaciÃ³n 24/7**: WebSocket listeners para trades y orderbook
2. **Procesamiento**: CÃ¡lculo de Volume Profile y Order Flow en tiempo real
3. **Almacenamiento**: MongoDB para histÃ³ricos, Redis para cachÃ©/streaming
4. **Limpieza**: Sistema automÃ¡tico de archivado/eliminaciÃ³n de datos antiguos
5. **API MCP**: FastMCP server para consumo desde wAIckoff MCP

## ğŸ”§ Principios de DiseÃ±o
1. **Modularidad extrema**: Un archivo = una responsabilidad
2. **OOP estricto**: Clases bien definidas con SRP
3. **Mantenibilidad**: CÃ³digo autodocumentado, tipado estricto
4. **Escalabilidad**: Preparado para mÃºltiples exchanges y sÃ­mbolos
5. **Robustez**: Manejo de errores, retry logic, circuit breakers

## ğŸ“ Estructura Actual de Carpetas
```
cloud_marketdata/
â”œâ”€â”€ claude/                 # DocumentaciÃ³n Claude
â”‚   â”œâ”€â”€ tasks/             # Task tracker
â”‚   â”œâ”€â”€ docs/              # DocumentaciÃ³n tÃ©cnica
â”‚   â”œâ”€â”€ adr/               # Architecture Decision Records
â”‚   â””â”€â”€ archive/           # Logs histÃ³ricos
â”œâ”€â”€ src/                   # CÃ³digo fuente
â”‚   â”œâ”€â”€ core/             # Config, logger
â”‚   â”œâ”€â”€ mcp_integration/  # FastMCP server + tools
â”‚   â”œâ”€â”€ entities/         # ğŸ†• Trade, TradeSide models
â”‚   â”œâ”€â”€ collectors/       # ğŸ†• WebSocket collectors
â”‚   â”‚   â”œâ”€â”€ base.py       # Abstract WebSocketCollector
â”‚   â”‚   â”œâ”€â”€ manager.py    # CollectorManager
â”‚   â”‚   â”œâ”€â”€ bybit/        # Bybit implementations
â”‚   â”‚   â””â”€â”€ storage/      # Storage handlers
â”‚   â””â”€â”€ main.py          # FastAPI + lifespan integration
â”œâ”€â”€ tests/                # Tests unitarios e integraciÃ³n
â”œâ”€â”€ docker/              # ConfiguraciÃ³n Docker
â””â”€â”€ config/             # ConfiguraciÃ³n y env
```

## ğŸ¯ Subfases AtÃ³micas Priorizadas (v2.0)
1. **TASK-001**: Setup Docker + FastAPI base (1.5h) âœ…
2. **TASK-001B**: FastMCP integration (1h) âœ…
3. **TASK-002A**: WebSocket base + Bybit trades (2h) âœ…
4. **TASK-002B**: OrderBook + Binance trades (2h) â³
5. **TASK-002C**: Production hardening (1.5h)
6. **TASK-003A**: MongoDB schemas bÃ¡sicos (1.5h)
7. **TASK-003B**: Schemas avanzados + TTL (1.5h)
8. **Continuar con TASK-004A...** - Ver task-tracker.md para lista completa

**ğŸš¨ REGLA CRÃTICA**: MÃ¡ximo 2h por subfase - Completable en una sesiÃ³n

## ğŸš€ VisiÃ³n Futura: wAIckoff Platform
- **Fase 1** (Actual): MCP Service para datos
- **Fase 2**: API Gateway + Analytics Engine
- **Fase 3**: Dashboard profesional (Next.js)
- **Fase 4**: IA Integration (LLM + ML)
- **Fase 5**: Trading Platform completa

Ver `claude/docs/roadmap-waickoff-platform.md` y ADR-004 para detalles.

## ğŸ”— IntegraciÃ³n con wAIckoff
- **Protocolo**: MCP sobre HTTP/WebSocket
- **Endpoints**: Volume Profile, Order Flow, Market Depth
- **Formato**: JSON con schemas Pydantic v2
- **AutenticaciÃ³n**: API Keys con rate limiting

## ğŸ”§ Reglas de Desarrollo
1. **Testing first**: TDD para todos los componentes
2. **Type hints**: 100% coverage con mypy
3. **Async by default**: Todo I/O debe ser async
4. **Logs estructurados**: JSON logging con context
5. **MÃ©tricas**: Prometheus-ready desde el inicio
6. **No hardcoding**: Todo configurable via env

## ğŸ“Š MÃ©tricas Target
- **Latencia**: < 10ms procesamiento por trade
- **Throughput**: 10k trades/segundo por sÃ­mbolo
- **Storage**: RetenciÃ³n configurable (1h-7d)
- **Uptime**: 99.9% con auto-recovery
- **CPU**: < 30% en condiciones normales
- **RAM**: < 1GB por proceso

## ğŸš¨ Consideraciones VPS
- **Storage limitado**: Implementar compresiÃ³n y rotaciÃ³n agresiva
- **CPU compartida**: Optimizar algoritmos para baja latencia
- **Network**: Retry logic y backpressure handling
- **Monitoring**: Alertas tempranas de recursos

## ğŸ”„ Principios de Subfases AtÃ³micas (NUEVO)
1. **MÃ¡ximo 2h por subfase** - Completable en una sesiÃ³n
2. **Criterio de completitud claro** - Verificable objetivamente
3. **Entregables especÃ­ficos** - Lista concreta de outputs
4. **Estado funcional** - Proyecto ejecutable tras cada subfase
5. **Rollback seguro** - FÃ¡cil reversiÃ³n si se interrumpe
6. **Dependencias explÃ­citas** - Sin ambigÃ¼edades

## ğŸ“Š MÃ©tricas del Proyecto v2.0
- **Total Subfases**: 16 (8 tareas â†’ 16 subfases atÃ³micas)
- **Horas Estimadas**: 26h (optimizado)
- **Completadas**: 3 (18.75%)
- **Restantes**: 13 (23.5h aprox)
- **Promedio por subfase**: 1.6h (mÃ¡ximo 2h)
- **Riesgo de interrupciÃ³n**: MINIMIZADO
- **Verificabilidad**: 100% con criterios objetivos

## ğŸ†• Funcionalidades TASK-002A Implementadas
- **Abstract WebSocketCollector**: Template pattern con reconexiÃ³n automÃ¡tica
- **BybitTradesCollector**: Collector funcional para trades BTCUSDT
- **Trade Entity**: Modelo Pydantic con validaciÃ³n completa
- **InMemoryStorage**: Almacenamiento para testing con estadÃ­sticas
- **CollectorManager**: GestiÃ³n centralizada de mÃºltiples collectors
- **FastAPI Integration**: Endpoints de monitoreo y health checks
- **Observabilidad**: Logging estructurado + mÃ©tricas + health status


