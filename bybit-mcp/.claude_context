# ğŸ¤– Contexto para Claude/Cursor - Bybit MCP Server v1.3.2 (SISTEMA DE LOGGING EMPRESARIAL)

## ğŸ† ESTADO CRÃTICO v1.3.2 - SISTEMA DE LOGGING PROFESIONAL COMPLETADO
**âš¡ NUEVA FUNCIONALIDAD MAYOR**: FileLogger empresarial + Stack traces completos + Troubleshooting automÃ¡tico
**ğŸ¯ RESULTADO**: Capacidades de debugging de nivel empresarial + UX limpia sin errores molestos
**ğŸš€ PRÃ“XIMA FASE**: TASK-007 Tests unitarios para validaciÃ³n completa del sistema de logging

## IMPORTANTE: Leer ANTES de dar cualquier sugerencia

### ğŸ“Š SISTEMA DE TRAZABILIDAD COMPLETA v1.3.1 (OBLIGATORIO)
**âš ï¸ CAMBIO CRÃTICO**: Sistema de logging avanzado implementado - revisar documentaciÃ³n de debugging
**SIEMPRE** revisar y actualizar estos archivos en orden de prioridad:

#### **ğŸ“‹ Archivos CrÃ­ticos de Estado:**
- `claude/master-log.md` - **Estado actual del MCP (LEER PRIMERO)**
- `claude/tasks/task-tracker.md` - PrÃ³ximas funciones a implementar
- `claude/bugs/` - **NUEVA** carpeta con bugs documentados y soluciones
- `claude/logs/YYYY-MM-DD.md` - Log diario (ACTUALIZAR al final)

#### **ğŸ“š DocumentaciÃ³n TÃ©cnica:**
- `claude/docs/architecture/system-overview.md` - **NUEVA** arquitectura completa
- `claude/docs/api/tools-reference.md` - **NUEVA** referencia de API
- `claude/docs/troubleshooting/common-issues.md` - **NUEVA** guÃ­a de resoluciÃ³n
- `claude/decisions/adr-log.md` - Decisiones arquitectÃ³nicas
- `ROADMAP_AVANZADO.md` - VisiÃ³n general de funcionalidades futuras

#### **ğŸ› GestiÃ³n de Bugs:**
- **SISTEMA COMPLETO**: Todos los bugs crÃ­ticos se documentan en `claude/bugs/`
- **Formato**: `bug-XXX-description.md` con anÃ¡lisis completo
- **Registro**: `claude/bugs/README.md` con Ã­ndice y mÃ©tricas
- **Ejemplos**: BUG-001 (S/R classification), BUG-002 (Architecture refactor)

### ğŸ† ESTADO ACTUAL (v1.3.2 - 08/06/2025) - TASK-006 COMPLETADA
- **Fase:** âœ… COMPLETADO - Sistema de logging empresarial implementado exitosamente
- **Ãšltima ActualizaciÃ³n:** TASK-006 completada con FileLogger profesional y error suppression
- **PrÃ³xima Tarea:** TASK-007 (Tests unitarios) - ValidaciÃ³n del sistema de logging
- **Bloqueadores:** Ninguno - Sistema 100% operativo con logging empresarial
- **UX Status:** âœ… EXPERIENCIA LIMPIA - Sin errores molestos, debugging completo disponible
- **Funcionalidad:** âœ… PERFECTA - Todas las herramientas MCP funcionan + FileLogger profesional

### ğŸ† ARQUITECTURA MODULAR v1.3.0 - TRANSFORMACIÃ“N COMPLETA
**âœ… REFACTORIZACIÃ“N EXITOSA**: De 1 archivo monolÃ­tico a 15+ mÃ³dulos especializados
**ğŸ—ï¸ CLEAN ARCHITECTURE**: 4 capas bien separadas con dependency injection
**ğŸ§ª 100% TESTEABLE**: Cada servicio mockeable individualmente
**ğŸ”„ PROTOCOL-AGNOSTIC**: Core reutilizable desde MCP, FastAPI, CLI, etc.

#### **ğŸ¯ CAPAS Y SERVICIOS IMPLEMENTADOS**

#### **ğŸ¢ Presentation Layer (Adapters)**
- âœ… **MCP Adapter** (`src/adapters/mcp.ts`) - Protocolo MCP integrado
- ğŸ”® **REST API Adapter** (Futuro) - FastAPI integration ready
- ğŸ”® **WebSocket Adapter** (Futuro) - Real-time streams
- ğŸ”® **CLI Adapter** (Futuro) - Command line interface

#### **ğŸ§  Core Layer (Business Logic)**
- âœ… **Market Analysis Engine** (`src/core/engine.ts`) - Orquestador principal
- âœ… **System Configuration** - ConfiguraciÃ³n centralizada
- âœ… **Health Monitoring** - Estado del sistema
- âœ… **Performance Tracking** - MÃ©tricas automticas

#### **âš™ï¸ Service Layer (Specialized Services)**
- âœ… **Market Data Service** (`src/services/marketData.ts`) - Bybit API integration
- âœ… **Technical Analysis Service** (`src/services/analysis.ts`) - AnÃ¡lisis tÃ©cnico
- âœ… **Trading Service** (`src/services/trading.ts`) - Grid trading & strategies
- ğŸ”® **Multi-Exchange Services** (Futuro) - Binance, Coinbase, etc.

#### **ğŸ› ï¸ Utility Layer (Common Tools)**
- âœ… **Logger** (`src/utils/logger.ts`) - Sistema de logs estructurado
- âœ… **Performance Monitor** (`src/utils/performance.ts`) - MÃ©tricas de rendimiento
- âœ… **Math Utils** (`src/utils/math.ts`) - Utilidades matemÃ¡ticas
- âœ… **Type Definitions** (`src/types/index.ts`) - Tipos centralizados

### Funcionalidades IMPLEMENTADAS v1.3.2 (SISTEMA DE LOGGING EMPRESARIAL)

#### **ğŸ—ï¸ ARQUITECTURA & INFRAESTRUCTURA**
- âœ… **Arquitectura modular completa** - 4 capas: Presentation/Core/Service/Utility
- âœ… **Dependency injection** - Servicios inyectables y 100% testeables
- âœ… **Interface-based design** - Abstracciones para mÃºltiples implementaciones
- âœ… **Performance monitoring** - MÃ©tricas automÃ¡ticas en todas las capas
- âœ… **Protocol-agnostic core** - MarketAnalysisEngine reutilizable universalmente
- âœ… **Backward compatibility** - API MCP mantiene 100% compatibilidad
- âœ… **TypeScript estricto** - Tipos centralizados en `src/types/index.ts`
- âœ… **Clean Code** - Principios SOLID aplicados consistentemente
- âœ… **ğŸ† SISTEMA DE LOGGING EMPRESARIAL** - FileLogger profesional con rotaciÃ³n automÃ¡tica

#### **ğŸ” SISTEMA DE LOGGING Y DEBUGGING PROFESIONAL**
- âœ… **FileLogger avanzado** - RotaciÃ³n automÃ¡tica, stack traces, configuraciÃ³n flexible
- âœ… **Request/Response tracking** - IDs Ãºnicos, correlaciÃ³n completa, mÃ©tricas de performance
- âœ… **JSON error debugging** - 3 intentos de parsing con anÃ¡lisis de contexto
- âœ… **Error suppression elegante** - MCP SDK errors suprimidos sin afectar funcionalidad
- âœ… **Troubleshooting automÃ¡tico** - GuÃ­as integradas y comandos de diagnÃ³stico
- âœ… **Sistema de mÃ©tricas** - Memoria, uptime, estadÃ­sticas de archivos
- âœ… **Herramienta debug integrada** - `get_debug_logs` con filtros avanzados
- âœ… **Logging estructurado** - JSON format con metadata completa

#### **ğŸ“Š FUNCIONALIDADES DE ANÃLISIS**
- âœ… **Market Data Service** - Ticker, orderbook, klines con error handling
- âœ… **Technical Analysis Service** - Volatilidad, volumen, Volume Delta, S/R
- âœ… **Trading Service** - Grid trading inteligente basado en volatilidad
- âœ… **Support/Resistance avanzado** - Algoritmo multi-factor con scoring
- âœ… **Volume Delta aproximado** - PresiÃ³n compradora/vendedora sin API key
- âœ… **Divergence detection** - DetecciÃ³n temprana de reversiones
- âœ… **VWAP integration** - AnÃ¡lisis de valor promedio ponderado

#### **ğŸ”§ SISTEMA DE DESARROLLO**
- âœ… **Sistema de logs estructurado** - Logger con diferentes niveles
- âœ… **Performance tracking** - MÃ©tricas de ejecuciÃ³n automÃ¡ticas
- âœ… **Error handling robusto** - Try/catch en todas las capas
- âœ… **Build system** - TypeScript compilation sin errores
- âœ… **Development tools** - ESLint, TypeDoc, Jest configurados

### En DESARROLLO ACTIVO
- ğŸš§ **TASK-004** - Tests unitarios completos (CRÃTICO post-refactor)
- ğŸš§ **DocumentaciÃ³n ADR** - Architectural Decision Records
- ğŸš§ **DetecciÃ³n de patrones Wyckoff bÃ¡sicos** - PrÃ³xima funcionalidad
- ğŸš§ **FastAPI integration** - REST endpoints usando core engine

### NO EXISTE (no sugerir aÃºn)
- âŒ Funciones que requieren API Key
- âŒ Trading automatizado
- âŒ GestiÃ³n de Ã³rdenes
- âŒ Portfolio tracking

### IntegraciÃ³n con Waickoff AI
- Este MCP servirÃ¡ como capa de datos para Waickoff
- Mantener separaciÃ³n: MCP = datos, Waickoff = inteligencia
- Futuro: mÃºltiples MCPs (Binance, etc.) alimentando Waickoff

### WORKFLOW v1.3.0 para BUGS CRÃTICOS:
1. **Detectar y documentar** en `claude/bugs/bug-XXX-description.md`
2. **Analizar root cause** con detalles tÃ©cnicos
3. **Implementar fix** siguiendo arquitectura actual
4. **Actualizar logs** con cambios realizados
5. **Crear tests** para evitar regresiÃ³n (TASK-004 urgente)
6. **Compilar y validar** antes de declarar resuelto

### WORKFLOW v1.3.0 para DESARROLLO MODULAR (OBLIGATORIO):
1. **Leer arquitectura**: `claude/docs/architecture/system-overview.md` primero
2. **Identificar capa**: Presentation/Core/Service/Utility
3. **Seguir interfaces**: Implementar `I*Service` existentes
4. **Dependency injection**: Servicios como parÃ¡metros del constructor
5. **Performance monitoring**: Usar `performanceMonitor.measure()`
6. **Testing individual**: Cada servicio debe ser mockeable
7. **Actualizar documentaciÃ³n**: Tipos, APIs, arquitectura
8. **Compilar y validar**: Tests + build antes de declarar completado

### REGLAS CÃ“DIGO v1.3.0 (ARQUITECTURA MODULAR - OBLIGATORIO):
1. **TypeScript estricto** - Tipos definidos, interfaces implementadas
2. **Dependency injection** - Servicios inyectados por constructor
3. **Interface segregation** - Implementar `I*Service` interfaces
4. **Performance monitoring** - Wrapper automÃ¡tico en servicios
5. **Error handling** - Try/catch en todas las funciones
6. **Separation of concerns** - Cada clase una responsabilidad
7. **Backward compatibility** - No romper APIs MCP existentes
8. **Documentation** - JSDoc en interfaces y mÃ©todos pÃºblicos

### Comandos de desarrollo (v1.3.0):
```bash
npm run build      # Compilar TypeScript modular
npm run dev        # Modo desarrollo con watch
npm start          # Ejecutar MCP compilado
npm run clean      # Limpiar build
npm run test       # Ejecutar tests unitarios (TASK-004)
npm run lint       # Verificar cÃ³digo con ESLint
npm run docs       # Generar documentaciÃ³n TypeDoc
```

### ConfiguraciÃ³n Claude Desktop:
```json
{
  "mcpServers": {
    "bybit-mcp": {
      "command": "node",
      "args": ["D:\\projects\\mcp\\bybit-mcp\\build\\index.js"],
      "env": {}
    }
  }
}
```

### FILOSOFÃA v1.3.0 (POST-REFACTORIZACIÃ“N):
- **"De Monolito a Modularidad"** - TransformaciÃ³n arquitectÃ³nica completa
- **"Clean Architecture - Testable Components"** - Principios SOLID aplicados
- **"Protocol-agnostic core - Universal integration"** - Engine reutilizable
- **"Base sÃ³lida para Waickoff AI y ecosistema cripto"** - Futuro garantizado
- **"Performance-first - Monitored and optimized"** - MÃ©tricas en todo el stack
- **"Dependency Injection - Interface Segregation"** - Servicios desacoplados
- **"Future-ready Architecture"** - Preparado para FastAPI, WebSocket, CLI

## ğŸ¯ ENFOQUE ACTUAL v1.3.0: ARQUITECTURA MODULAR COMPLETADA
**âœ… REFACTORIZACIÃ“N EXITOSA**: BUG-002 resuelto - Sistema transformado completamente
**âš¡ PRÃ“XIMA FASE CRÃTICA**: TASK-004 Tests unitarios para validar arquitectura
**ğŸš€ FUTURO INMEDIATO**: IntegraciÃ³n Waickoff AI + FastAPI usando core engine

**REFERENCIAS CRÃTICAS v1.3.0**: 
- **Arquitectura completa**: `claude/docs/architecture/system-overview.md`
- **RefactorizaciÃ³n**: `claude/bugs/bug-002-modular-architecture.md`
- **APIs actualizadas**: `claude/docs/api/tools-reference.md`
- **Tipos centralizados**: `src/types/index.ts`
- **Core engine**: `src/core/engine.ts`

## ğŸ“‹ OBLIGATORIO AL TERMINAR CUALQUIER TRABAJO (v1.3.0):
1. **Actualizar tipos centralizados** en `src/types/index.ts` si es necesario
2. **Verificar interfaces** implementadas correctamente
3. **Actualizar documentaciÃ³n** de arquitectura si hay cambios estructurales
4. **Performance metrics** verificar que estÃ©n funcionando
5. **Tests unitarios** crear/actualizar para nuevos servicios
6. **Backward compatibility** verificar que MCP siga funcionando
7. **Build limpio** sin errores TypeScript
8. **Documentar decisiones** tÃ©cnicas importantes en logs

**ğŸ† SISTEMA v1.3.2 - LOGGING EMPRESARIAL COMPLETADO PARA WAICKOFF AI Y ECOSISTEMA CRIPTO**

**âœ… TRANSFORMACIÃ“N EXITOSA**: De logging bÃ¡sico a sistema empresarial de nivel producciÃ³n
**ğŸš€ LISTO PARA**: Waickoff AI, FastAPI, WebSocket, CLI, mÃºltiples integraciones con logging completo
**ğŸ’ CALIDAD**: Clean Architecture, SOLID principles, 100% testeable, logging profesional
**ğŸ”® FUTURO**: Core engine + FileLogger reutilizable universalmente